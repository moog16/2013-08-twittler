<!DOCTYPE html>
<html>
  <head>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
    <style>
    body {
      /*background-color: #66b6ff;*/
      background-image: url('./cream_pixels.png');
    }
    div.tweet {
      height: 75px;
      width: 400px;
      background-color: #ceebff;
      border: 1px solid #666699;
      border-bottom: 0px;
      margin-left: 30%;
      position: relative;
      font-family: Arial, Helvetica, sans-serif;
      font: 13px;
    }
    span.time {
      color: #3e3dcc;
      float: right;
      position: absolute;
      bottom: 0;
      right: 0;
      font-size: 13px;
      height: 13px;
      width: 135px;
    }
    a.tweetUser {
      color: #cc6e3d;
      font-size: 20px;
    }
    a:hover {
      cursor: pointer;
    }
    span.message {
      display: block;
      margin-left: 10px;
    }
    </style>
  </head>
  <body>
    <script>

      $(document).ready( function() {
        update();
      });
      
      var index;
      var refreshFeed = setInterval(update, 3000);

      function getTime(time) {
        var hours = time.getHours(),
        minutes = time.getMinutes(),
        seconds = time.getSeconds(),
        month = time.getMonth() + 1,
        day = time.getDate(),
        year = time.getFullYear();
        var meridiem;
        var day;

        if(minutes < 10) {
          minutes = "0" + minutes;
        };
        if(hours > 11) {
          meridiem = "PM"; 
        }
        else {
          meridiem = "AM";
        };
        if(seconds < 10) {
          seconds = "0" +seconds;
        };
        hours = hours%12;

        var monthDate = month + "/" + day + "/" + year;
        var timeDate = hours + ":" + minutes + ":" + seconds + " " + meridiem;

        return timeDate + " " + monthDate;
      };

      function getTweet(num, index, names) {
        if(num == null) {
          return streams.home[index];
        }
        else {
          var names = getKeys(streams.users);
          var username = names[num];
          var findUser = streams.users[username][0].user;
          var currentUser = streams.home[index].user;
          if(findUser == streams.home[index].user){
            return streams.home[index];
          }
          else {
            index -= 1;
            console.log(index);
            return getTweet(num,index,names);
          };
        };
      };

      function update(usernameNum) {
        var $body = $('body');
        $body.html('');

        index = streams.home.length - 1;
        var names = getKeys(streams.users);
        var nameNum;

        while(index >= 0){
          /* if there is a usernameNum, then we want to pick out a specific 
            user timeline. */

          tweet = getTweet(usernameNum,index,names);
          
          //console.log(tweet);
          for(var i=0; i<names.length; i++) {
            if(names[i] == tweet.user) {
              nameNum = i;
            };
          };
          console.log(tweet);

          // setup tweet
          var $tweet = $('<div class="tweet"></div>');
          var $tweetMessage = $('<span class="message"></span>');
          var $tweetUser = $('<a class="tweetUser" onclick="updateTimeLine('+ nameNum + ')"></a>');
          var $dateTime = $('<span class="time"></span>');
          var timeText = getTime(tweet.created_at);

          // create tweet message & layout
          $tweetUser.text('@' + tweet.user);
          $tweetMessage.text(tweet.message);
          $dateTime.text(timeText);
          $tweetUser.appendTo($tweet);
          $tweetMessage.appendTo($tweet);
          $dateTime.appendTo($tweet);

          $tweet.appendTo($body);
          index -= 1;
        };
      };

      function updateTimeLine(userNum) {
        clearInterval(refreshFeed);
        refreshFeed = setInterval(update(userNum), 3000);
      };

      function getKeys(collect) {
        var keys = [];
        for( var key in collect ) {
          keys.push(key);
        };
        return keys;
      };

    </script>
  </body>
</html>
